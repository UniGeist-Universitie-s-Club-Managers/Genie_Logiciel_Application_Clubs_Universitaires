{% extends "base.html" %}
{% load static %}

{% block title %}{{ thread.title }} — MonForum{% endblock %}

{% block extra_css %}
<style>
/* Thread detail & posts — style harmonisé avec base.html */
.card {
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

.card-body {
  padding: 20px;
  color: #f8f9fa;
}

h2, h4, h5 {
  color: #fff;
}

.text-muted {
  color: rgba(255,255,255,0.6) !important;
}

p {
  color: #f8f9fa;
}

a.btn-sm.btn-outline-secondary,
a.btn-sm.btn-outline-danger {
  border-radius: 8px;
  padding: 4px 10px;
}

a.btn-sm.btn-outline-secondary:hover {
  background-color: rgba(108,117,125,0.2);
}

a.btn-sm.btn-outline-danger:hover {
  background-color: rgba(220,53,69,0.2);
}

button.btn-success {
  border-radius: 10px;
  padding: 6px 16px;
}

.alert {
  border-radius: 8px;
}

form .mb-3 {
  margin-bottom: 1rem;
}
</style>
{% endblock %}

{% block content %}
<div class="mb-3 d-flex justify-content-between align-items-start">
  <div>
    <h2 class="mb-1">{{ thread.title }}</h2>
    <div class="text-muted small">
      par {{ thread.author.username }} — {{ thread.created_at|date:"d M Y H:i" }}
    </div>
  </div>
  <div class="text-end">
    {% if can_edit_thread %}
      <a class="btn btn-sm btn-outline-secondary" href="{% url 'forum:thread-update' thread.pk %}">Modifier</a>
    {% endif %}
    {% if can_delete_thread %}
      <a class="btn btn-sm btn-outline-danger" href="{% url 'forum:thread-delete' thread.pk %}">Supprimer</a>
    {% endif %}
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <p class="card-text" style="white-space: pre-wrap;">{{ thread.body|linebreaksbr }}</p>
  </div>
</div>

<h4 class="h5">Réponses ({{ posts|length }})</h4>

{% for post in posts %}
  <div class="card mb-2">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div>
          <strong>{{ post.author.username }}</strong>
          <span class="text-muted small"> — {{ post.created_at|date:"d M Y H:i" }}</span>
        </div>
        <div>
          {% if post.can_edit %}
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'forum:post-update' post.pk %}">Modifier</a>
          {% endif %}
          {% if post.can_delete %}
            <a class="btn btn-sm btn-outline-danger" href="{% url 'forum:post-delete' post.pk %}">Supprimer</a>
          {% endif %}
        </div>
      </div>
      <p class="mt-2" style="white-space: pre-wrap;">{{ post.content|linebreaksbr }}</p>
    </div>
  </div>
{% empty %}
  <div class="alert alert-light">Pas encore de réponses. Sois le premier à répondre !</div>
{% endfor %}

<!-- Formulaire de réponse -->
<div class="card mt-4">
  <div class="card-body">
    <h5>Répondre</h5>
    {% if can_reply %}
      <form method="post" action="">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="mb-3">
          {{ form.content.errors }}
          {{ form.content }}
        </div>
        <button class="btn btn-success" type="submit">Envoyer la réponse</button>
      </form>
    {% elif not user.is_authenticated %}
      <div class="alert alert-warning">
        Tu dois <a href="{% url 'login' %}">te connecter</a> pour répondre.
      </div>
    {% else %}
      <div class="alert alert-warning mb-0">
        Vous n'avez pas la permission de répondre dans ce forum.
      </div>
    {% endif %}
  </div>
</div>

<a class="btn btn-link mt-3" href="{% url 'forum:thread-list' %}">&larr; Retour à la liste des sujets</a>
{% endblock %}
