{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block title %}{% if object %}Modifier{% else %}Créer{% endif %} un forum — UniForum{% endblock %}

{% block extra_css %}
<style>
/* Page create/update forum — petit module de style harmonisé avec le thème */
/* Card layout */
.form-card {
  max-width: 900px;
  margin: 0 auto;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55));
  box-shadow: 0 12px 30px rgba(0,0,0,0.35);
}

.form-card .card-header {
  background: transparent;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  color: #fff;
}

.form-card .card-header h3 {
  margin: 0;
  font-weight: 800;
}

/* Form controls */
.form-group label.form-label {
  color: rgba(255,255,255,0.95);
  font-weight: 600;
}

.form-control {
  background: rgba(255,255,255,0.03);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 10px;
  padding: 10px 14px;
}

.form-control:focus {
  background: rgba(0,0,0,0.95);
  border-color: var(--primary-color);
  box-shadow: 0 6px 18px rgba(102,126,234,0.08);
  color: #fff;
}

/* Help text & errors */
.form-text { color: rgba(255,255,255,0.65); }
.text-danger { color: #ffb3b3; }

/* Buttons */
.form-actions {
  display: flex;
  gap: 12px;
  margin-top: 14px;
  flex-wrap: wrap;
}

.btn-primary {
  border-radius: 10px;
  padding: 10px 18px;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  border: none;
  color: #fff;
}

.btn-secondary {
  border-radius: 10px;
  padding: 10px 18px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.06);
  color: #fff;
}

/* Club field visibility helper */
#club-field-container {
  transition: all 0.22s ease;
}

/* Responsive */
@media (max-width: 576px) {
  .form-card { padding: 0 12px; }
  .form-actions { flex-direction: column; }
  .btn { width: 100%; }
}
</style>
{% endblock %}

{% block content %}
<div class="form-card card">
  <div class="card-header">
    <h3 class="mb-0">{% if object %}Modifier le forum{% else %}Créer un nouveau forum{% endif %}</h3>
  </div>

  <div class="card-body">
    <form method="post" novalidate id="forum-form">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div class="mb-3 form-group">
        <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
        {{ form.title|add_class:"form-control" }}
        {% if form.title.errors %}
          <div class="text-danger small mt-1">
            {{ form.title.errors }}
          </div>
        {% endif %}
      </div>

      <div class="mb-3 form-group">
        <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
        {{ form.description|add_class:"form-control" }}
        {% if form.description.errors %}
          <div class="text-danger small mt-1">
            {{ form.description.errors }}
          </div>
        {% endif %}
      </div>

      <div class="mb-3 form-group">
        <label for="{{ form.visibility.id_for_label }}" class="form-label">{{ form.visibility.label }}</label>
        {{ form.visibility|add_class:"form-control" }}
        {% if form.visibility.errors %}
          <div class="text-danger small mt-1">
            {{ form.visibility.errors }}
          </div>
        {% endif %}
        <div class="form-text">Les forums privés ne sont visibles que par les membres du club associé.</div>
      </div>

      {% if form.club %}
      <div class="mb-3 form-group" id="club-field-container">
        <label for="{{ form.club.id_for_label }}" class="form-label">{{ form.club.label }}</label>
        {{ form.club|add_class:"form-control" }}
        {% if form.club.errors %}
          <div class="text-danger small mt-1">
            {{ form.club.errors }}
          </div>
        {% endif %}
        {% if form.club.help_text %}
          <div class="form-text">{{ form.club.help_text }}</div>
        {% endif %}
      </div>
      {% endif %}

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          {% if object %}Enregistrer les modifications{% else %}Créer le forum{% endif %}
        </button>
        <a href="{% url 'forum:forum-list' %}" class="btn btn-secondary">Annuler</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  // utilitaire pour ajouter classe côté template (fallback si filter absent)
  function qsel(s){ return document.querySelector(s); }

  // Toggle du champ "club" selon la visibilité (si présent)
  var visibilityField = document.getElementById('{{ form.visibility.id_for_label }}');
  var clubContainer = document.getElementById('club-field-container');

  function updateClubVisibility(){
    if (!visibilityField || !clubContainer) return;
    var val = visibilityField.value || visibilityField.options && visibilityField.options[visibilityField.selectedIndex].value;
    if (val === 'private' || val === 'privé' || val === 'prive') {
      clubContainer.style.display = '';
    } else {
      clubContainer.style.display = 'none';
    }
  }

  updateClubVisibility();
  if (visibilityField) {
    visibilityField.addEventListener('change', updateClubVisibility);
  }

  // Accessibility: focus first field on create
  var firstField = document.querySelector('#forum-form .form-control');
  if (firstField) firstField.focus();
});
</script>
{% endblock %}
